<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Aurora Health — Keyboard Inaccessibility Demo (Accordion Fixed)</title>
<style>
  :root{
    --bg:#ffffff; --ink:#1f2a37; --muted:#6b7b8d; --line:#e6edf7;
    --brand:#2c7be5; --ok:#22c55e; --warn:#f59e0b;
  }
  html,body{height:100%}
  body{margin:0; background:var(--bg); color:var(--ink);
    font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;}
  a{color:var(--brand); text-underline-offset:2px}
  .container{max-width:1000px; margin:0 auto; padding:32px 20px 140px}
  header{border-bottom:1px solid var(--line); background:#f7fbff}
  .nav{max-width:1000px; margin:0 auto; padding:14px 20px; display:flex; justify-content:space-between; align-items:center}
  .brand{display:flex; align-items:center; gap:10px; font-weight:800}
  .logo{width:34px;height:34px;border-radius:9px;
        background: radial-gradient(120% 120% at 20% 10%, #8bb7ff 0%, #2c7be5 45%, #47b5c6 100%);
        box-shadow:0 3px 10px rgba(47,107,237,.25)}
  h1{font-size:clamp(26px,4.5vw,40px); margin:18px 0 6px}
  .lead{color:var(--muted); margin:0 0 24px}

  .grid{display:grid; grid-template-columns:repeat(auto-fit,minmax(260px,1fr)); gap:18px}

  .card{border:1px solid var(--line); border-radius:16px; padding:16px; background:#fff}
  .card h2{margin:.2rem 0 .6rem; font-size:20px}
  .foot{color:var(--muted); font-size:14px; margin-top:8px}

  /* ------- Custom, initially inaccessible controls ------- */
  .x-checkbox{display:flex; align-items:center; gap:10px; cursor:pointer; user-select:none}
  .x-box{width:20px; height:20px; border:2px solid #91a3bd; border-radius:6px; display:grid; place-items:center}
  .x-box .tick{width:12px; height:12px; border-radius:3px; background:transparent}
  .x-checkbox.on .x-box .tick{background:var(--brand)}

  .x-toggle{width:44px; height:26px; background:#d7dfef; border-radius:999px; position:relative; cursor:pointer}
  .x-toggle .knob{position:absolute; top:3px; left:3px; width:20px; height:20px; background:#fff; border-radius:999px; transition:left .18s ease}
  .x-toggle.on{background:#bee3f8}
  .x-toggle.on .knob{left:21px}

  .x-accordion{border:1px solid var(--line); border-radius:12px; overflow:hidden}
  .x-accordion .hdr{padding:12px 14px; background:#f8fbff; cursor:pointer; font-weight:700}
  .x-accordion .panel{padding:12px 14px; display:none}
  .x-accordion.open .panel{display:block}
  .x-accordion .hdr.focus-ring:focus {
    outline: none;                /* prevent the clipped outside outline */
    box-shadow: inset 0 0 0 3px #94c2ff;
    border-radius: 8px;           /* match the visual style */
  }

  .x-select{position:relative; border:1px solid var(--line); border-radius:10px; background:#fff; cursor:pointer}
  .x-select .label{padding:10px 12px}
  .x-select .menu{position:absolute; left:0; right:0; top:100%; background:#fff; border:1px solid var(--line);
                  border-radius:10px; margin-top:6px; box-shadow:0 8px 24px rgba(0,0,0,.08); display:none; z-index:5}
  .x-select.open .menu{display:block}
  .x-select .option{padding:10px 12px}
  .x-select .option:hover{background:#f5f8ff}

  .focus-ring:focus{outline:3px solid #94c2ff; outline-offset:2px; border-radius:8px}

  .a11y-legend{
    position:fixed; left:16px; right:16px; bottom:16px; z-index:50;
    display:flex; flex-direction:column; gap:8px; align-items:center; justify-content:center;
    padding:10px 14px; border-radius:14px; background:rgba(17,24,39,.95); color:#fff; font-weight:600; text-align:center;
    box-shadow:0 6px 24px rgba(0,0,0,.25);
  }
  .row{display:flex; gap:12px; flex-wrap:wrap; justify-content:center}
  .btn{all:unset; cursor:pointer; padding:8px 12px; border-radius:10px; font-weight:800}
  .btn.primary{background:#22c55e; color:#052e12}
  .btn.warn{background:#ffd166; color:#3b2600}
  .btn.secondary{background:#bbdcff; color:#0b2a66}
  .btn[hidden]{display:none!important}

  #problem-note[hidden]{display:none!important}
  #problem-note{max-width:900px; color:#fff; font-weight:500; opacity:.95}
  code{font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; background:#0b1220; color:#c9e2ff; padding:2px 6px; border-radius:6px}
</style>
</head>
<body>
<header>
  <div class="nav">
    <div class="brand"><div class="logo" aria-hidden="true"></div>Aurora&nbsp;Health</div>
    <nav aria-label="Primary"><a href="#">Patients</a> · <a href="#">Clinicians</a> · <a href="#">About</a></nav>
  </div>
</header>

<main class="container">
  <h1>Keyboard Inaccessibility: Custom Controls</h1>
  <p class="lead">These look nice — but try tabbing. Initially, you can’t reach or operate them with the keyboard.</p>

  <div class="grid">

    <section class="card" aria-labelledby="pref">
      <h2 id="pref">Notification preferences (custom checkboxes)</h2>
      <div class="x-checkbox" data-type="checkbox" data-checked="false">
        <div class="x-box"><div class="tick"></div></div>
        <span>Email reminders</span>
      </div>
      <div class="x-checkbox" data-type="checkbox" data-checked="true">
        <div class="x-box"><div class="tick"></div></div>
        <span>SMS alerts</span>
      </div>
      <div class="x-checkbox" data-type="checkbox" data-checked="false">
        <div class="x-box"><div class="tick"></div></div>
        <span>Push notifications</span>
      </div>
      <p class="foot">Problem: no <code>tabindex</code>, <code>role</code>, or keyboard handlers.</p>
    </section>

    <section class="card" aria-labelledby="privacy">
      <h2 id="privacy">Privacy setting (custom toggle)</h2>
      <div class="x-toggle" data-type="switch" data-checked="false" aria-hidden="true">
        <div class="knob"></div>
      </div>
      <div class="foot">Problem: can’t focus or toggle with keyboard.</div>
    </section>

    <section class="card" aria-labelledby="faq">
      <h2 id="faq">FAQ (custom accordion)</h2>
      <div class="x-accordion" data-type="accordion">
        <div class="hdr">How do I reschedule an appointment?</div>
        <div class="panel">Use the portal or call our care team — rescheduling is free up to 24 hours before your visit.</div>
      </div>
      <div class="foot">Problem: header is a generic <code>div</code>, not focusable, no Enter/Space handling.</div>
    </section>

    <section class="card" aria-labelledby="dept">
      <h2 id="dept">Choose department (custom select)</h2>
      <div class="x-select" data-type="select" data-open="false">
        <div class="label">Cardiology</div>
        <div class="menu">
          <div class="option" data-value="Cardiology">Cardiology</div>
          <div class="option" data-value="Oncology">Oncology</div>
          <div class="option" data-value="Pediatrics">Pediatrics</div>
        </div>
      </div>
      <div class="foot">Problem: cannot open with keyboard, options aren’t reachable with arrows.</div>
    </section>

  </div>
</main>

<div class="a11y-legend" role="region" aria-label="Demo controls">
  <div class="row">
    <button id="fixBtn" class="btn primary">Fix</button>
    <button id="unfixBtn" class="btn warn" hidden>Unfix</button>
    <button id="showBtn" class="btn secondary">Show Problems</button>
  </div>
  <div id="problem-note" hidden>
    <span>
      These custom UI elements were <strong>mouse-only</strong>: missing <code>tabindex="0"</code>, semantic <code>role</code>s
      (<code>checkbox</code>, <code>switch</code>, <code>button</code>, <code>listbox</code>), and keyboard handlers
      (Space/Enter/Arrow keys). Many users navigate by keyboard or switch devices — without these, the controls are effectively invisible.
      Click <strong>Fix</strong> to add proper semantics and interactions.
    </span>
  </div>
</div>

<script>
  /* ========= Mouse behavior BEFORE "Fix" ========= */

  // 1) Checkboxes (mouse-only)
  document.querySelectorAll('.x-checkbox').forEach(cb=>{
    cb.addEventListener('click', ()=>toggleCheckbox(cb));
    if(cb.dataset.checked === 'true') cb.classList.add('on'); else cb.classList.remove('on');
  });
  function toggleCheckbox(el){
    const isOn = el.dataset.checked === 'true';
    el.dataset.checked = String(!isOn);
    el.classList.toggle('on', !isOn);
  }

  // 2) Toggle switch (mouse-only)
  document.querySelectorAll('.x-toggle').forEach(sw=>{
    sw.addEventListener('click', ()=>toggleSwitch(sw));
    if(sw.dataset.checked === 'true') sw.classList.add('on'); else sw.classList.remove('on');
  });
  function toggleSwitch(el){
    const isOn = el.dataset.checked === 'true';
    el.dataset.checked = String(!isOn);
    el.classList.toggle('on', !isOn);
  }

  // 3) Accordion (mouse-only) — use a NAMED handler we can remove later
  document.querySelectorAll('.x-accordion').forEach(acc=>{
    const hdr = acc.querySelector('.hdr');

    function basicAccordionClick(){ acc.classList.toggle('open'); }
    hdr._basicAccordionClick = basicAccordionClick;     // store ref so we can remove it
    hdr.addEventListener('click', basicAccordionClick);
  });

  // 4) Custom select (mouse-only)
  document.querySelectorAll('.x-select').forEach(sel=>{
    const label = sel.querySelector('.label');
    const options = sel.querySelectorAll('.option');
    label.addEventListener('click', ()=> sel.classList.toggle('open'));
    options.forEach(opt=>{
      opt.addEventListener('click', ()=>{
        setSelected(sel, opt);
        sel.classList.remove('open');
      });
    });
    document.addEventListener('click', (e)=>{ if(!sel.contains(e.target)) sel.classList.remove('open'); });
  });

  /* ========= Demo control buttons ========= */
  const fixBtn = document.getElementById('fixBtn');
  const unfixBtn = document.getElementById('unfixBtn');
  const showBtn = document.getElementById('showBtn');
  const note = document.getElementById('problem-note');

  let fixed = false;
  let problemsShown = false;

  showBtn.addEventListener('click', ()=>{
    problemsShown = !problemsShown;
    note.hidden = !problemsShown;
    showBtn.textContent = problemsShown ? 'Hide Problems' : 'Show Problems';
  });

  fixBtn.addEventListener('click', ()=>{
    if (fixed) return;
    applyFixes();
    fixed = true;
    fixBtn.hidden = true;
    unfixBtn.hidden = false;
    note.hidden = false;
    showBtn.textContent = 'Hide Problems';
    problemsShown = true;
  });

  unfixBtn.addEventListener('click', ()=>{
    if (!fixed) return;
    revertFixes();
    fixed = false;
    unfixBtn.hidden = true;
    fixBtn.hidden = false;
  });

  /* ========= Apply accessibility fixes ========= */
  function applyFixes(){
    // 1) Checkboxes: role, tabindex, aria-checked, keyboard
    document.querySelectorAll('.x-checkbox').forEach(cb=>{
      cb.setAttribute('role','checkbox');
      cb.setAttribute('tabindex','0');
      cb.classList.add('focus-ring');
      syncCheckboxAria(cb);
      cb.addEventListener('keydown', onCheckboxKey);
    });

    // 2) Switch: role="switch", tabindex, aria-checked, keyboard
    document.querySelectorAll('.x-toggle').forEach(sw=>{
      sw.removeAttribute('aria-hidden');
      sw.setAttribute('role','switch');
      sw.setAttribute('tabindex','0');
      sw.classList.add('focus-ring');
      syncSwitchAria(sw);
      sw.addEventListener('keydown', onSwitchKey);
    });

    // 3) Accordion: remove BASIC click handler, add ARIA-aware handler + keyboard
    document.querySelectorAll('.x-accordion').forEach(acc=>{
      const hdr = acc.querySelector('.hdr');
      const panel = acc.querySelector('.panel');
      const pid = panel.id || ('panel-' + Math.random().toString(36).slice(2));
      panel.id = pid;

      // remove the initial mouse-only handler
      if (hdr._basicAccordionClick){
        hdr.removeEventListener('click', hdr._basicAccordionClick);
        delete hdr._basicAccordionClick;
      }

      // promote to button-like control
      hdr.setAttribute('role','button');
      hdr.setAttribute('tabindex','0');
      hdr.classList.add('focus-ring');
      hdr.setAttribute('aria-controls', pid);
      hdr.setAttribute('aria-expanded', acc.classList.contains('open') ? 'true' : 'false');

      function enhancedAccordionClick(){
        acc.classList.toggle('open');
        hdr.setAttribute('aria-expanded', acc.classList.contains('open') ? 'true' : 'false');
      }
      hdr._enhancedAccordionClick = enhancedAccordionClick;
      hdr.addEventListener('click', enhancedAccordionClick);

      hdr.addEventListener('keydown', (e)=>{
        if(e.key === ' ' || e.key === 'Enter'){
          e.preventDefault();
          enhancedAccordionClick();
        }
      });
    });

    // 4) Custom select → button + listbox behavior
    document.querySelectorAll('.x-select').forEach(sel=>{
      const label = sel.querySelector('.label');
      const menu = sel.querySelector('.menu');
      const options = sel.querySelectorAll('.option');

      label.setAttribute('role','button');
      label.setAttribute('tabindex','0');
      label.classList.add('focus-ring');
      label.setAttribute('aria-haspopup','listbox');
      const mid = menu.id || ('listbox-' + Math.random().toString(36).slice(2));
      menu.id = mid;
      label.setAttribute('aria-controls', mid);
      label.setAttribute('aria-expanded', 'false');

      menu.setAttribute('role','listbox');
      options.forEach((opt,i)=>{
        opt.setAttribute('role','option');
        opt.setAttribute('tabindex','-1');
        if(i===0) opt.setAttribute('aria-selected','true');
      });

      label.addEventListener('keydown', (e)=>{
        if(e.key === ' ' || e.key === 'Enter' || e.key === 'ArrowDown'){
          e.preventDefault(); openSelect(sel);
        } else if(e.key === 'ArrowUp'){
          e.preventDefault(); openSelect(sel); moveActiveOption(sel, -1);
        }
      });

      menu.addEventListener('keydown',(e)=>{
        if(e.key === 'Escape'){ e.preventDefault(); closeSelect(sel); label.focus(); }
        else if(e.key === 'ArrowDown'){ e.preventDefault(); moveActiveOption(sel, +1); }
        else if(e.key === 'ArrowUp'){ e.preventDefault(); moveActiveOption(sel, -1); }
        else if(e.key === 'Enter' || e.key === ' '){ e.preventDefault(); commitActiveOption(sel); closeSelect(sel); label.focus(); }
      });

      // keep existing click behavior
      label.addEventListener('click', ()=> toggleSelect(sel));
      options.forEach(opt=>{
        opt.addEventListener('click', ()=>{ setSelected(sel, opt); closeSelect(sel); label.focus(); });
      });
    });
  }

  /* ========= Revert fixes ========= */
  function revertFixes(){
    // 1) Checkboxes
    document.querySelectorAll('.x-checkbox').forEach(cb=>{
      cb.removeAttribute('role'); cb.removeAttribute('tabindex'); cb.removeAttribute('aria-checked');
      cb.classList.remove('focus-ring');
      cb.removeEventListener('keydown', onCheckboxKey);
    });

    // 2) Switch
    document.querySelectorAll('.x-toggle').forEach(sw=>{
      sw.setAttribute('aria-hidden','true');
      sw.removeAttribute('role'); sw.removeAttribute('tabindex'); sw.removeAttribute('aria-checked');
      sw.classList.remove('focus-ring');
      sw.removeEventListener('keydown', onSwitchKey);
    });

    // 3) Accordion — remove enhanced handler, restore basic click handler
    document.querySelectorAll('.x-accordion').forEach(acc=>{
      const hdr = acc.querySelector('.hdr');
      const panel = acc.querySelector('.panel');

      if (hdr._enhancedAccordionClick){
        hdr.removeEventListener('click', hdr._enhancedAccordionClick);
        delete hdr._enhancedAccordionClick;
      }

      hdr.removeAttribute('role'); hdr.removeAttribute('tabindex'); hdr.classList.remove('focus-ring');
      hdr.removeAttribute('aria-controls'); hdr.removeAttribute('aria-expanded');

      // reattach the basic mouse-only handler we used initially
      function basicAccordionClick(){ acc.classList.toggle('open'); }
      hdr._basicAccordionClick = basicAccordionClick;
      hdr.addEventListener('click', basicAccordionClick);
    });

    // 4) Custom select
    document.querySelectorAll('.x-select').forEach(sel=>{
      const label = sel.querySelector('.label');
      const menu = sel.querySelector('.menu');
      const options = sel.querySelectorAll('.option');
      label.removeAttribute('role'); label.removeAttribute('tabindex'); label.classList.remove('focus-ring');
      label.removeAttribute('aria-haspopup'); label.removeAttribute('aria-controls'); label.removeAttribute('aria-expanded');
      menu.removeAttribute('role');
      options.forEach(opt=>{ opt.removeAttribute('role'); opt.removeAttribute('tabindex'); opt.removeAttribute('aria-selected'); });
    });
  }

  /* ========= Helpers ========= */
  function syncCheckboxAria(cb){
    const isOn = cb.dataset.checked === 'true';
    cb.setAttribute('aria-checked', String(isOn));
  }
  function onCheckboxKey(e){
    if(e.key === ' ' || e.key === 'Enter'){ e.preventDefault(); this.click(); syncCheckboxAria(this); }
  }

  function syncSwitchAria(sw){
    const isOn = sw.dataset.checked === 'true';
    sw.setAttribute('aria-checked', String(isOn));
  }
  function onSwitchKey(e){
    if(e.key === ' ' || e.key === 'Enter'){ e.preventDefault(); this.click(); syncSwitchAria(this); }
  }

  function toggleSelect(sel){ sel.classList.toggle('open'); const label=sel.querySelector('.label'); label.setAttribute('aria-expanded', String(sel.classList.contains('open'))); if(sel.classList.contains('open')) focusActiveOption(sel); }
  function openSelect(sel){ if(!sel.classList.contains('open')) { sel.classList.add('open'); sel.querySelector('.label').setAttribute('aria-expanded','true'); focusActiveOption(sel); } }
  function closeSelect(sel){ if(sel.classList.contains('open')) { sel.classList.remove('open'); sel.querySelector('.label').setAttribute('aria-expanded','false'); } }
  function focusActiveOption(sel){
    const opts = sel.querySelectorAll('.option');
    const active = Array.from(opts).find(o=>o.getAttribute('aria-selected')==='true') || opts[0];
    active.tabIndex = 0; active.focus();
  }
  function moveActiveOption(sel, delta){
    const opts = Array.from(sel.querySelectorAll('.option'));
    let i = opts.findIndex(o=>o === document.activeElement);
    if(i < 0) i = opts.findIndex(o=>o.getAttribute('aria-selected')==='true');
    let ni = (i + delta + opts.length) % opts.length;
    opts.forEach(o=>o.tabIndex = -1);
    opts[ni].tabIndex = 0; opts[ni].focus();
  }
  function commitActiveOption(sel){
    const active = document.activeElement.closest('.option');
    if(active) setSelected(sel, active);
  }
  function setSelected(sel, opt){
    sel.querySelectorAll('.option').forEach(o=>o.setAttribute('aria-selected','false'));
    opt.setAttribute('aria-selected','true');
    sel.querySelector('.label').textContent = opt.dataset.value;
  }
</script>
</body>
</html>
